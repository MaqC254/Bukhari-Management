<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bukhari Restaurant Waiting Application</title>
    <link rel="stylesheet" href="../styles/mobile.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <img src="../images/Bukhari logo.jpg" alt="Bukhari Logo" class="logo">
            <h1>Bukhari Restaurant Waiting Application</h1>
            <div class="icon"><!-- Add icon here --></div>
        </header>
        <main>
            <p class="payment-method">Online Payment:</p>
            <form id="paymentForm" action="orderstate.html" method="GET">
                <label for="phone-input">Enter Phone number to pay with</label>
                <input type="text" id="phone-input" name="phone" placeholder="07xxxxxxxx" required>

                <label for="location">Select Your Location</label>
                <select id="location" name="location" required>
                    <option value="" disabled selected>Select a location</option>
                    <option value="nyeri-town">Nyeri Town</option>
                    <option value="kiganjo">Kiganjo</option>
                    <option value="kiangoma">Kiangoma</option>
                    <option value="mweiga">Mweiga</option>
                    <option value="karatina">Karatina</option>
                    <!-- Add more locations as needed -->
                </select>
                <span id="shipping-fee" class="shipping-fee"></span>

                <p id="shipping-fee"></p>

                <label for="mpesa-code">Enter M-Pesa Transaction Code</label>
                <input type="text" id="mpesa-code" name="mpesaCode" placeholder="SH674HWX83" required>

                <p id="amount"></p>
                <button type="submit" class="confirm-button">Confirm</button>
            </form>
            <div class="payment-received" style="display: none;">
                <img src="../images/paid.png" alt="Check Icon" class="check-icon">
                <p>Payment Received!</p>
            </div>
            <!-- <div class="waiter-image">
                <img src="../images/waiter.jpeg" alt="Waiter Image">
            </div> -->
        </main>
        <footer>
            <p>Bukhari</p>
            <p>version 1.0.0</p>
        </footer>
    </div>

    <script>
        // 
        // Shipping fees by location
        const shippingFees = {
            'nyeri-town': 1000,
            'kiganjo': 1500,
            'kiangoma': 2000,
            'mweiga': 2500,
            'karatina': 3000
        };

        document.addEventListener('DOMContentLoaded', () => {
            const total = localStorage.getItem('total');
            document.getElementById('amount').textContent = `Amount: Tsh. ${total}`;
        });

        $(document).ready(function() {
            $('#location').on('change', function() {
                const selectedLocation = $(this).val();
                const foodAmount = parseInt(localStorage.getItem('total'), 10) || 0;
                const shippingFee = shippingFees[selectedLocation] || 0;
                const totalAmount = foodAmount + shippingFee;
                
                $('#shipping-fee').text(`Shipping Fee: Tsh. ${shippingFee}`);
                $('#amount').text(`Total: Tsh. ${totalAmount}`);
            });
        });
        // document.addEventListener('DOMContentLoaded', () => {
        //     const total = localStorage.getItem('total');
        //     document.getElementById('amount').textContent = `Amount: Tsh. ${total}`;
        // });

        $(document).ready(function() {
            $('#paymentForm').on('submit', function(event) {
                event.preventDefault(); // Prevent the form from submitting the traditional way
                
                // Get form data
                var phoneNumber = $('#phone-input').val();
                var mpesaCode = $('#mpesa-code').val();
                var location = $('#location').val();
                var amount = $('#amount').text().replace('Total Amount: Tsh. ', '');
                // Send data to your server
                $.ajax({
                    url: '/submit-payment', // Your server endpoint
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        phoneNumber: phoneNumber,
                        mpesaCode: mpesaCode,
                        amount: amount
                    }),
                    success: function(response) {
                        alert('Payment request sent! Check your phone.');
                        window.location.href = 'orderstate.html';
                    },
                    error: function(error) {
                        console.error('Error:', error);
                        alert('An error occurred while initiating payment.');
                    }
                });
            });
        });

    </script>
</body>
</html>
