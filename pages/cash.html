<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bukhari Restaurant - Cash Payment</title>
    <link rel="stylesheet" href="../styles/cash.css">
</head>
<body>
    <div class="container">
        <header>
            <img src="../images/Bukhari logo.jpg" alt="Bukhari Logo" class="logo">
            <h1>Bukhari Restaurant Waiting Application</h1>
            <div class="icon"><!-- Add icon here --></div>
        </header>
        <main>
            <p class="payment-confirmation">Confirm Cash Payment<br>
                <span id="amount"></span>
            </p>
            <button class="confirm-button" onclick="confirmPayment()">Confirm</button>
            <div class="payment-received">
                <img src="../images/paid.png" alt="Check Icon" class="check-icon">
            </div>
            <div class="waiter-image">
                <img src="../images/waiter.jpeg" alt="Waiter Image">
            </div>
        </main>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const total = localStorage.getItem('selectedTableTotal');
                document.getElementById('amount').textContent = `Amount: Tsh. ${total}`;
            });

            async function confirmPayment() {
                const tableNumber = localStorage.getItem('selectedTableNumber');

                if (!tableNumber) {
                    alert('No table number found. Please try again.');
                    return;
                }

                try {
                    // Fetch items by table number
                    const itemsResponse = await fetch(`/api/items?tableNumber=${tableNumber}`);
                    const items = await itemsResponse.json();

                    // Update each item as paid
                    await Promise.all(items.map(item => 
                        fetch(`/update-paid/${item._id}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                            }
                        })
                    ));

                    alert('Payment confirmed. Thank you!');
                    window.location.href = '../views/venueMenu.ejs'; // Redirect to venue menu or another page
                } catch (error) {
                    console.error('Error confirming payment:', error);
                    alert('Failed to confirm payment. Please try again.');
                }
            }
        </script>

        <footer>
            <img src="../images/Bukhari logo.jpg" alt="Bukhari Small Logo" class="small-logo">
            <p>Bukhari</p>
            <p>version 1.0.0</p>
        </footer>
    </div>
</body>
</html>
