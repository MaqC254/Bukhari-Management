<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload SMS Verification</title>
    <link rel="stylesheet" href="../styles/mobile.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <img src="../images/Bukhari logo.jpg" alt="Bukhari Logo" class="logo">
            <h1>Upload SMS Verification</h1>
        </header>
        <main>
            <form id="smsForm">
                <label for="mpesa-code">Enter M-Pesa Transaction Code:</label>
                <input type="text" id="mpesa-code" name="mpesaCode" placeholder="SH674HWX83" required>
                
                <button type="submit" class="submit-button">Verify</button>
            </form>
            <div id="response" style="display: none;">
                <!-- This will display the response from the server -->
            </div>
        </main>
        <footer>
            <p>Bukhari</p>
            <p>version 1.0.0</p>
        </footer>
    </div>

    <script>
        $(document).ready(function() {
            $('#smsForm').on('submit', function(event) {
                event.preventDefault(); // Prevent the form from submitting traditionally

                // Get form data
                var mpesaCode = $('#mpesa-code').val();

                // Send data to your server
                $.ajax({
                    url: '/api/payments/store-request', // Ensure this endpoint matches your server setup
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        mpesaCode: mpesaCode
                    }),
                    success: function(response) {
                        $('#response').html(`<p>${response.message}</p>`).show();
                    },
                    error: function(error) {
                        console.error('Error:', error);
                        $('#response').html('<p>An error occurred while verifying the SMS.</p>').show();
                    }
                });
            });
        });
    </script>
</body>
</html>
