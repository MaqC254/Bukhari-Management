<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bukhari Restaurant - Servers Application</title>
    <link rel="stylesheet" href="../styles/server.css">
</head>
<body>
    <!-- Side Menu -->
    <span class="open-menu" onclick="openMenu()">&#9776;</span>
    <div id="mySideMenu" class="side-menu">
        <a href="javascript:void(0)" class="closebtn" onclick="closeMenu()">&times;</a>
        <a href="../pages/index.html">Home</a>
        <a href="../views/available.ejs">Available Meals</a>
        <a href="../pages/add-meal.html">Add Meal</a>
        <a href="../pages/customer_signin.html">Log Out</a>
    </div>
    <header>
        <!-- <img src="../images/Bukhari logo.jpg" alt="Bukhari Restaurant Logo" class="logo"> -->
        <h1>BUKHARI RESTAURANT</h1>
        <!-- <h2>Servers Application</h2> -->
    </header>

    <main>
        <a href="../views/available.ejs" class="nav-button">Modify Available Meals</a>  
        <h3>Orders List</h3>
        <div id="orders-list"></div>
    </main>

    <footer>
        <p>Bukhari<br>
        2024<br>
        version 1.0.0</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetch('/get-items')
                .then(response => response.json())
                .then(data => {
                    const ordersList = document.getElementById('orders-list');
                    data.forEach(item => {
                        const orderSection = document.createElement('section');
                        orderSection.className = 'order';

                        const orderHeader = document.createElement('div');
                        orderHeader.className = 'order-header';

                        const span = document.createElement('span');
                        span.textContent = item.name;

                        const button = document.createElement('button');
                        button.className = `status ${item.state === 'venue' ? 'served' : 'packed'}`;
                        button.textContent = item.state === 'venue' ? 'Served' : 'Packed';

                        button.addEventListener('click', () => {
                            fetch(`/update-item/${item._id}`, { method: 'PUT' })
                                .then(response => response.json())
                                .then(updatedItem => {
                                    if (updatedItem.state === 'done') {
                                        orderSection.remove();
                                    }
                                })
                                .catch(error => console.error('Error:', error));
                        });

                        orderHeader.appendChild(span);
                        orderHeader.appendChild(button);

                        const ul = document.createElement('ul');

                        const li = document.createElement('li');
                        li.className = 'food-details'; // Apply class for smaller font size
                        li.textContent = `${item.name} `;
                        const spanQuantity = document.createElement('span');
                        spanQuantity.textContent = `x${item.quantity}`;

                        li.appendChild(spanQuantity);
                        ul.appendChild(li);

                        // Add phone number or server ID based on state
                        const infoLi = document.createElement('li');
                        infoLi.textContent = item.state === 'venue' ? `Server ID: ${item.customerPhone}` : `Phone: ${item.customerPhone}`;
                        ul.appendChild(infoLi);

                        // Add the upload SMS button
                        if (item.state === 'Served' || 'Packed') {
                            const smsButton = document.createElement('button');
                            smsButton.textContent = 'Upload Payment SMS';
                            smsButton.classList.add('upload-sms-button'); // Apply the CSS class
                            smsButton.addEventListener('click', () => {
                                window.location.href = '/pages/upload-sms.html';
                            });
                            orderSection.appendChild(smsButton);
                        }

                        orderSection.appendChild(orderHeader);
                        orderSection.appendChild(ul);

                        ordersList.appendChild(orderSection);
                    });
                })
                .catch(error => console.error('Error:', error));
        });

         // Function to open side menu
         function openMenu() {
            document.getElementById("mySideMenu").style.width = "200px";
            document.getElementById("main").style.marginLeft = "200px";
        }

        // Function to close side menu
        function closeMenu() {
            document.getElementById("mySideMenu").style.width = "0";
            document.getElementById("main").style.marginLeft = "0";
        }

    </script>
</body>
</html>
