<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bukhari Restaurant - Servers Application</title>
    <link rel="stylesheet" href="../styles/server.css">
</head>
<body>
    <header>
        <img src="../images/Bukhari logo.jpg" alt="Bukhari Restaurant Logo" class="logo">
        <h1>Bukhari Restaurant</h1>
        <h2>Servers Application</h2>
        <a href="../views/available.ejs" class="nav-button">Modify Available Meals</a>
    </header>
    
    <main>
        <h3>Orders List</h3>
        <div id="orders-list"></div>
    </main>

    <footer>
        <img src="../images/Bukhari logo.jpg" alt="Bukhari Restaurant Footer Logo" class="footer-logo">
        <p>Bukhari</p>
        <p>2024</p>
        <p>version 1.0.0</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetch('/get-items')
                .then(response => response.json())
                .then(data => {
                    const ordersList = document.getElementById('orders-list');
                    data.forEach(item => {
                        const orderSection = document.createElement('section');
                        orderSection.className = 'order';

                        const orderHeader = document.createElement('div');
                        orderHeader.className = 'order-header';

                        const span = document.createElement('span');
                        span.textContent = item.name;

                        const button = document.createElement('button');
                        button.className = `status ${item.state === 'venue' ? 'served' : 'packed'}`;
                        button.textContent = item.state === 'venue' ? 'Served' : 'Packed';

                        button.addEventListener('click', () => {
                            fetch(`/update-item/${item._id}`, { method: 'PUT' })
                                .then(response => response.json())
                                .then(updatedItem => {
                                    if (updatedItem.state === 'done') {
                                        orderSection.remove();
                                    }
                                })
                                .catch(error => console.error('Error:', error));
                        });

                        orderHeader.appendChild(span);
                        orderHeader.appendChild(button);

                        const ul = document.createElement('ul');

                        const li = document.createElement('li');
                        li.textContent = `${item.name} `;
                        const spanQuantity = document.createElement('span');
                        spanQuantity.textContent = `x${item.quantity}`;

                        li.appendChild(spanQuantity);
                        ul.appendChild(li);

                        // Add phone number or server ID based on state
                        const infoLi = document.createElement('li');
                        infoLi.textContent = item.state === 'venue' ? `Server ID: ${item.serverId}` : `Phone: ${item.phoneNumber}`;
                        ul.appendChild(infoLi);

                        orderSection.appendChild(orderHeader);
                        orderSection.appendChild(ul);

                        ordersList.appendChild(orderSection);
                    });
                })
                .catch(error => console.error('Error:', error));
        });
    </script>
</body>
</html>
